!function(){"use strict";const e=()=>{const e=document.querySelector("form#quick-reply a.close-btn");e&&e.addEventListener("click",(()=>(()=>{const e=document.querySelector("body > form[name='post'] textarea[name='body']");e&&(e.value="")})()))},t=e=>(e.files?.length??0)>0,n=e=>e.type.startsWith("image/"),o=e=>{if(!t(e))return null;const o=e.files[0];return n(o)?o:null},i=()=>{const e=document.querySelector("form#quick-reply textarea[name='body']"),t=document.querySelector("form#quick-reply #upload_file");e?.addEventListener("paste",(e=>{const o=e.clipboardData?.items;if(!o)return;const i=(e=>{if(e.length>1)return null;const t=e[0].getAsFile();return t&&n(t)?t:null})(o);if(!i||!t)return;const r=new DataTransfer;r.items.add(i),t.files=r.files,t.dispatchEvent(new Event("change",{bubbles:!0}))}))};var r=[],a=[];function l(e,t){if(e&&"undefined"!=typeof document){var n,o=!0===t.prepend?"prepend":"append",i=!0===t.singleTag,l="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(i){var c=r.indexOf(l);-1===c&&(c=r.push(l)-1,a[c]={}),n=a[c]&&a[c][o]?a[c][o]:a[c][o]=s()}else n=s();65279===e.charCodeAt(0)&&(e=e.substring(1)),n.styleSheet?n.styleSheet.cssText+=e:n.appendChild(document.createTextNode(e))}function s(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var n=Object.keys(t.attributes),i=0;i<n.length;i++)e.setAttribute(n[i],t.attributes[n[i]]);var r="prepend"===o?"afterbegin":"beforeend";return l.insertAdjacentElement(r,e),e}}l('#quick-reply #upload .spoiler{padding-right:0}#quick-reply #upload .spoiler>input,#quick-reply #upload .spoiler>label{display:none}#quick-reply:has(#upload_file:not(.has-attachment)) .q-toolbar-buttons{display:none}#quick-reply:has(#upload_file:not(.has-image)) .btn-container:has(#q-preview-image),#quick-reply:has(#upload_file:not(.has-image)) .btn-container:has(#q-spoiler-image-custom){display:none}#quick-reply .q-toolbar-buttons{--btn-size:14px;align-items:center;display:flex;gap:4px;justify-content:end;padding-right:2px}#quick-reply .q-toolbar-buttons .btn-container{align-items:center;border:1px solid;border-radius:2px;box-sizing:border-box;display:inline-flex;font-family:monospace;font-size:var(--btn-size,14px);height:var(--btn-size,14px);justify-content:center;position:relative;width:var(--btn-size,14px)}#quick-reply .q-toolbar-buttons .btn-container>:before{bottom:0;content:"";cursor:pointer;left:0;position:absolute;right:0;top:0}#quick-reply .q-toolbar-buttons .btn-container label{font-size:var(--btn-size,14px)}#quick-reply .q-toolbar-buttons .btn-container a{color:inherit;text-decoration:none}#quick-reply .q-toolbar-buttons input[type=checkbox]{margin:0;padding:0}#quick-reply .q-toolbar-buttons input[type=checkbox]:checked+.btn-container,#quick-reply .q-toolbar-buttons input[type=checkbox]:checked+label,#quick-reply .q-toolbar-buttons input[type=checkbox]:not(:checked){display:none}#quick-reply #q-remove-image{padding-bottom:2px}#q-image-preview-modal{align-items:center;background-color:rgba(0,0,0,.3);display:flex;height:100%;justify-content:center;left:0;position:fixed;top:0;width:100%;z-index:101}#q-image-preview-modal img{max-height:100%;max-width:100%}',{});const c=(e,t,n)=>`<div title="${n}" class="btn-container btn"><a id="${e}" href="javascript:;">${t}</a></div>`,s=e=>{const n=e.target;if(!n)return;if(!t(n))return n.classList.toggle("has-attachment",!1),void n.classList.toggle("has-image",!1);n.classList.toggle("has-attachment",!0);o(n)&&n.classList.toggle("has-image",!0)},d=e=>{const t=o(e);var n;t&&(n=t,new Promise(((e,t)=>{const o=new FileReader;o.addEventListener("load",(({target:t})=>{e(t?.result)})),o.addEventListener("error",(e=>{t(e)})),o.readAsDataURL(n)}))).then((e=>{if(!e)return;const t=document.createElement("div");t.id="q-image-preview-modal",t.innerHTML=`<img src="${e}" />`,document.body.appendChild(t),t.addEventListener("click",(({currentTarget:e})=>{const t=e;t?.remove()}))}))},u=()=>{const e=document.querySelector("form#quick-reply #upload_file"),t=document.querySelector("form#quick-reply #upload .spoiler");if(!e||!t)return;const n=document.createElement("div");n.className="q-toolbar-buttons",t.appendChild(n);for(const e of[c("q-preview-image","P","Preview image"),(o="q-spoiler-image-custom",i="spoiler",r="S",a="Spoiler image",`<div title="${a}" class="btn-container toggle"><input id="${o}" class="btn-toggle" name="${i}" type="checkbox" /><label for="${o}">${r}</label></div>`),c("q-remove-image","Ã—","Remove attachment")])n.insertAdjacentHTML("beforeend",e);var o,i,r,a;const l=document.getElementById("q-preview-image"),u=document.getElementById("q-remove-image");e.addEventListener("change",s),l.addEventListener("click",(()=>d(e))),u.addEventListener("click",(()=>(e=>{e.value="",e.dispatchEvent(new Event("change",{bubbles:!0}))})(e)))};l("#quick-reply #upload{background-color:#fff;border:1px solid}#quick-reply #upload>td{cursor:text}#quick-reply #upload_file{display:none}#quick-reply #upload_filename{border:none;outline:none;padding-bottom:0}",{});const p=()=>{const e=document.querySelector("form#quick-reply"),n=document.querySelector("form#quick-reply #upload_file"),o=document.querySelector("form#quick-reply #upload .spoiler");if(!n||!o)return;n.insertAdjacentHTML("afterend",'<input id="upload_filename" type="text" name="filename" placeholder="Click to upload file" />');const i=document.getElementById("upload_filename");e&&i&&(i.addEventListener("click",(()=>(e=>{(e.files?.length??1)>0||e.click()})(n))),n.addEventListener("change",(e=>((e,t)=>{const n=e.target;if(!n)return;if((n.files?.length??0)<1)return void(t.value="");t.value=n.files[0].name;const o=t.value.length;t.setSelectionRange(o,o)})(e,i))),n.addEventListener("cancel",(()=>(e=>{e.blur()})(i))),i.addEventListener("blur",(e=>((e,n)=>{const o=e.target;if(!o||!t(n))return;const i=n.files[0],r=o.value;if(i.name===r)return;const a=new File([i],r,{type:i.type,lastModified:i.lastModified}),l=new DataTransfer;l.items.add(a),n.files=l.files})(e,n))))},m=()=>{p(),e(),i(),u()};try{((e,t,n=!1)=>{if(document.body.querySelector(t))return void e();new MutationObserver(((o,i)=>{for(const r of o)for(const o of r.addedNodes)if(1===o.nodeType&&o.matches(t))return e(),void(n&&i.disconnect())})).observe(document.body,{childList:!0,subtree:!0})})(m,"form#quick-reply")}catch(e){console.log("[quick-reply-addon]",e)}}();
//# sourceMappingURL=quick-reply-addon.js.map
