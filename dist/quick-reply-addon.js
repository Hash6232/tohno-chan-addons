!function(){"use strict";const e=()=>{const e=document.querySelector("form#quick-reply a.close-btn");e&&e.addEventListener("click",(()=>(()=>{const e=document.querySelector("body > form[name='post'] textarea[name='body']");e&&(e.value="")})()))},t=e=>(e.files?.length??0)>0,n=e=>{if(!t(e))return null;const n=e.files[0];return(e=>e.type.startsWith("image/"))(n)?n:null};var i=[],o=[];function r(e,t){if(e&&"undefined"!=typeof document){var n,r=!0===t.prepend?"prepend":"append",a=!0===t.singleTag,l="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(a){var c=i.indexOf(l);-1===c&&(c=i.push(l)-1,o[c]={}),n=o[c]&&o[c][r]?o[c][r]:o[c][r]=s()}else n=s();65279===e.charCodeAt(0)&&(e=e.substring(1)),n.styleSheet?n.styleSheet.cssText+=e:n.appendChild(document.createTextNode(e))}function s(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var n=Object.keys(t.attributes),i=0;i<n.length;i++)e.setAttribute(n[i],t.attributes[n[i]]);var o="prepend"===r?"afterbegin":"beforeend";return l.insertAdjacentElement(o,e),e}}r('#quick-reply #upload{background-color:#fff;border:1px solid}#quick-reply #upload>td{cursor:text}#quick-reply #upload .spoiler{padding-right:0}#quick-reply #upload .spoiler>input,#quick-reply #upload .spoiler>label{display:none}#quick-reply:has(#upload_file:not(.has-attachment)) .q-toolbar-buttons{display:none}#quick-reply:has(#upload_file:not(.has-image)) .btn-container:has(#q-preview-image),#quick-reply:has(#upload_file:not(.has-image)) .btn-container:has(#q-spoiler-image-custom){display:none}#quick-reply #upload_filename{border:none;outline:none}#quick-reply .q-toolbar-buttons{align-items:center;display:flex;gap:4px;justify-content:end;padding-right:2px}#quick-reply .q-toolbar-buttons .btn-container{--btn-size:14px;align-items:center;border:1px solid;border-radius:2px;box-sizing:border-box;display:inline-flex;height:var(--btn-size,14px);justify-content:center;position:relative;width:var(--btn-size,14px)}#quick-reply .q-toolbar-buttons .btn-container>:before{bottom:0;content:"";cursor:pointer;left:0;position:absolute;right:0;top:0}#quick-reply .q-toolbar-buttons .btn-container label{font-family:monospace;font-size:14px;line-height:1rem}#quick-reply .q-toolbar-buttons .btn-container a{color:inherit;text-decoration:none}#quick-reply .q-toolbar-buttons .btn-container #q-remove-image{padding-left:1px}#quick-reply .q-toolbar-buttons input[type=checkbox]{margin:0;padding:0}#quick-reply .q-toolbar-buttons input[type=checkbox]:checked+.btn-container,#quick-reply .q-toolbar-buttons input[type=checkbox]:checked+label,#quick-reply .q-toolbar-buttons input[type=checkbox]:not(:checked){display:none}#q-image-preview-modal{align-items:center;background-color:rgba(0,0,0,.3);display:flex;height:100%;justify-content:center;left:0;position:fixed;top:0;width:100%;z-index:101}#q-image-preview-modal img{max-height:100%;max-width:100%}',{});const a=(e,t,n)=>`<div title="${n}" class="btn-container btn"><a id="${e}" href="javascript:;">${t}</a></div>`,l=e=>{const i=e.target;if(!i)return;if(!t(i))return i.classList.toggle("has-attachment",!1),void i.classList.toggle("has-image",!1);i.classList.toggle("has-attachment",!0);n(i)&&i.classList.toggle("has-image",!0)},c=e=>{const t=n(e);var i;t&&(i=t,new Promise(((e,t)=>{const n=new FileReader;n.addEventListener("load",(({target:t})=>{e(t?.result)})),n.addEventListener("error",(e=>{t(e)})),n.readAsDataURL(i)}))).then((e=>{if(!e)return;const t=document.createElement("div");t.id="q-image-preview-modal",t.innerHTML=`<img src="${e}" />`,document.body.appendChild(t),t.addEventListener("click",(({currentTarget:e})=>{const t=e;t?.remove()}))}))},s=()=>{const e=document.querySelector("form#quick-reply #upload_file"),t=document.querySelector("form#quick-reply #upload .spoiler");if(!e||!t)return;const n=document.createElement("div");n.className="q-toolbar-buttons",t.appendChild(n);for(const e of[a("q-preview-image","P","Preview image"),(i="q-spoiler-image-custom",o="spoiler",r="S",s="Spoiler image",`<div title="${s}" class="btn-container toggle"><input id="${i}" class="btn-toggle" name="${o}" type="checkbox" /><label for="${i}">${r}</label></div>`),a("q-remove-image","Ã—","Remove attachment")])n.insertAdjacentHTML("beforeend",e);var i,o,r,s;const d=document.getElementById("q-preview-image"),u=document.getElementById("q-remove-image");e.addEventListener("change",l),d.addEventListener("click",(()=>c(e))),u.addEventListener("click",(()=>(e=>{e.value="",e.dispatchEvent(new Event("change",{bubbles:!0}))})(e)))};r("#quick-reply #upload_file{display:none}",{});const d=()=>{const e=document.querySelector("form#quick-reply"),t=document.querySelector("form#quick-reply #upload_file"),n=document.querySelector("form#quick-reply #upload .spoiler");if(!t||!n)return;t.insertAdjacentHTML("afterend",'<input id="upload_filename" type="text" name="filename" placeholder="Click to upload file" />');const i=document.getElementById("upload_filename");e&&i&&(i.addEventListener("click",(()=>(e=>{(e.files?.length??1)>0||e.click()})(t))),t.addEventListener("change",(e=>((e,t)=>{const n=e.target;if(!n)return;if((n.files?.length??0)<1)return void(t.value="");t.value=n.files[0].name;const i=t.value.length;t.setSelectionRange(i,i)})(e,i))),t.addEventListener("cancel",(()=>(e=>{e.blur()})(i))),e.addEventListener("submit",(()=>((e,t)=>{if((e.files?.length??0)<1)return;const n=e.files[0],i=t.value,o=new File([n],i,{type:n.type,lastModified:n.lastModified}),r=new DataTransfer;r.items.add(o),e.files=r.files})(t,i))))},u=()=>{d(),e(),(()=>{const e=document.querySelector("form#quick-reply textarea[name='body']"),t=document.querySelector("form#quick-reply #upload_file");e?.addEventListener("paste",(e=>{const n=e.clipboardData?.items;if(!n||n.length>1)return;const i=n[0];if(!i.type.startsWith("image/"))return;const o=i.getAsFile();if(!o||!t)return;const r=new DataTransfer;r.items.add(o),t.files=r.files,t.dispatchEvent(new Event("change",{bubbles:!0}))}))})(),s()};try{((e,t,n=!1)=>{if(document.body.querySelector(t))return void e();new MutationObserver(((i,o)=>{for(const r of i)for(const i of r.addedNodes)if(1===i.nodeType&&i.matches(t))return e(),void(n&&o.disconnect())})).observe(document.body,{childList:!0,subtree:!0})})(u,"form#quick-reply")}catch(e){console.log("[quick-reply-addon]",e)}}();
//# sourceMappingURL=quick-reply-addon.js.map
