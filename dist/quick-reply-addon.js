!function(){"use strict";var e,t,n;!function(e){var t;e.updateFile=(e,t)=>new File([e],t.filename??e.name,{type:e.type,lastModified:t.lastModified??e.lastModified}),e.isImage=e=>e.type.startsWith("image/"),e.getDataURL=e=>new Promise(((t,n)=>{const o=new FileReader;o.addEventListener("load",(({target:e})=>{t(e?.result)})),o.addEventListener("error",(e=>{n(e)})),o.readAsDataURL(e)})),(e.Clipboard||(e.Clipboard={})).getImage=t=>{if(1!==t.files.length)return null;const n=t.files[0];return e.isImage(n)?n:null},(e.Fetch||(e.Fetch={})).getImage=async t=>{try{const n=await fetch(t);if(!n.ok)throw new Error("Request failed with status code: "+n.status);const o=await n.blob();if(!e.isImage(o))throw new Error("Wrong file type: "+o.type);const i=new URL(t).pathname.split("/").pop()??"file";return new File([o],i,{type:o.type})}catch(e){console.log(e)}},(t=e.Form||(e.Form={})).hasFile=e=>(e.files?.length??0)>0,t.getFiles=e=>t.hasFile(e)?e.files:null,t.addFile=(e,t)=>{const n=new DataTransfer;n.items.add(t),e.files=n.files,e.dispatchEvent(new Event("change",{bubbles:!0}))}}(e||(e={})),function(e){e.onContentLoaded=(e,t)=>{for(const n of[t].flat())if(n)return void e();document.addEventListener("DOMContentLoaded",(()=>e()))},e.onElementLoaded=(e,t,n=!1)=>{if(document.body.querySelector(t))return void e();new MutationObserver(((o,i)=>{for(const r of o)for(const o of r.addedNodes)if(1===o.nodeType&&o.matches(t))return e(),void(n&&i.disconnect())})).observe(document.body,{childList:!0,subtree:!0})},e.onElementVisible=(e,t,n)=>{new IntersectionObserver(((e,n)=>{e.forEach((e=>{if(e.isIntersecting&&1===e.target.nodeType){for(const n of t)n(e.target);n.unobserve(e.target)}}))}),n??{root:null,rootMargin:"0px",threshold:.1}).observe(e)}}(t||(t={})),function(e){e.dateStringToRelative=e=>{const t=new Date,n=new Date(e),o=Math.floor((t.getTime()-n.getTime())/1e3);return((e,t)=>{const n=new Intl.RelativeTimeFormat("en",{numeric:"auto"}),o=t?-1:1;if(e<60)return n.format(e*o,"second");const i=Math.floor(e/60);if(i<60)return n.format(i*o,"minute");const r=Math.floor(i/60);if(r<24)return n.format(r*o,"hour");const a=Math.floor(r/24);if(a<30)return n.format(a*o,"day");const l=Math.floor(a/30);if(l<12)return n.format(l*o,"month");const c=Math.floor(a/365);return n.format(c*o,"year")})(Math.abs(o),o>0)}}(n||(n={}));const o=()=>{const e=document.querySelector("form#quick-reply a.close-btn");e&&e.addEventListener("click",(()=>(()=>{const e=document.querySelector("body > form[name='post'] textarea[name='body']");e&&(e.value="")})()))},i=({label:e,title:t})=>`<div title="${t}" class="btn-container btn"><a href="javascript:;">${e}</a></div>`;var r=[],a=[];function l(e,t){if(e&&"undefined"!=typeof document){var n,o=!0===t.prepend?"prepend":"append",i=!0===t.singleTag,l="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(i){var c=r.indexOf(l);-1===c&&(c=r.push(l)-1,a[c]={}),n=a[c]&&a[c][o]?a[c][o]:a[c][o]=s()}else n=s();65279===e.charCodeAt(0)&&(e=e.substring(1)),n.styleSheet?n.styleSheet.cssText+=e:n.appendChild(document.createTextNode(e))}function s(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var n=Object.keys(t.attributes),i=0;i<n.length;i++)e.setAttribute(n[i],t.attributes[n[i]]);var r="prepend"===o?"afterbegin":"beforeend";return l.insertAdjacentElement(r,e),e}}l('#quick-reply #upload .spoiler{padding-right:0}#quick-reply #upload .spoiler>input,#quick-reply #upload .spoiler>label{display:none}#quick-reply:has(#upload_file:not(.has-attachment)) .btn-container[data-if=attachment]{display:none}#quick-reply:has(#upload_file:not(.has-image)) .btn-container[data-if=image]{display:none}#quick-reply .q-toolbar-buttons{--btn-size:14px;align-items:center;display:flex;gap:4px;justify-content:end;padding-right:2px}#quick-reply .q-toolbar-buttons .btn-container{align-items:center;border:1px solid;border-radius:2px;box-sizing:border-box;display:inline-flex;font-family:monospace;font-size:var(--btn-size,14px);height:var(--btn-size,14px);justify-content:center;position:relative;width:var(--btn-size,14px)}#quick-reply .q-toolbar-buttons .btn-container>:before{bottom:0;content:"";cursor:pointer;left:0;position:absolute;right:0;top:0}#quick-reply .q-toolbar-buttons .btn-container label{font-size:var(--btn-size,14px)}#quick-reply .q-toolbar-buttons .btn-container a{color:inherit;text-decoration:none}#quick-reply .q-toolbar-buttons input[type=checkbox]{margin:0;padding:0}#quick-reply .q-toolbar-buttons input[type=checkbox]:checked+.btn-container,#quick-reply .q-toolbar-buttons input[type=checkbox]:checked+label,#quick-reply .q-toolbar-buttons input[type=checkbox]:not(:checked){display:none}#quick-reply #q-remove-image{padding-bottom:2px}#image-preview-modal{align-items:center;background-color:rgba(0,0,0,.3);display:flex;height:100%;justify-content:center;left:0;position:fixed;top:0;width:100%;z-index:101}#image-preview-modal img{max-height:100%;max-width:100%}',{});const c=t=>{const n=t.target;if(!n)return;if(!e.Form.hasFile(n))return n.classList.toggle("has-attachment",!1),void n.classList.toggle("has-image",!1);n.classList.toggle("has-attachment",!0);const o=e.Form.getFiles(n)?.[0];o&&e.isImage(o)&&n.classList.toggle("has-image",!0)},s=()=>{const t=document.querySelector("form#quick-reply #upload_file"),n=document.querySelector("form#quick-reply #upload .spoiler");if(!t||!n)return;const o=document.createElement("div");o.className="q-toolbar-buttons",n.appendChild(o);o.insertAdjacentHTML("beforeend",i({label:"P",title:"Preview image"}));const r=o.lastElementChild;r.id="q-preview-image",r.dataset.if="image";o.insertAdjacentHTML("beforeend",(({label:e,title:t,id:n})=>`<div title="${t}" class="btn-container toggle"><input id="${n}" type="checkbox" /><label for="${n}">${e}</label></div>`)({label:"S",title:"Spoiler image",id:"q-spoiler-image-custom"}));const a=o.lastElementChild;a.name="spoiler",a.dataset.if="image";o.insertAdjacentHTML("beforeend",i({label:"U",title:"Import image from URL"}));const l=o.lastElementChild;l.id="q-import-image";o.insertAdjacentHTML("beforeend",i({label:"Ã—",title:"Remove attachment"}));const s=o.lastElementChild;s.id="q-remove-attachment",s.dataset.if="attachment",t.addEventListener("change",c),r.addEventListener("click",(()=>(t=>{const n=e.Form.getFiles(t)?.[0];n&&e.isImage(n)&&e.getDataURL(n).then((e=>{if(!e)return;const t=document.createElement("div");t.id="image-preview-modal",t.innerHTML=`<img src="${e}" />`,document.body.appendChild(t),t.addEventListener("click",(({currentTarget:e})=>{const t=e;t?.remove()}))}))})(t))),l.addEventListener("click",(()=>(t=>{const n=prompt("Enter a valid image URL:");n&&e.Fetch.getImage(n).then((n=>{n&&e.Form.addFile(t,n)}))})(t))),s.addEventListener("click",(()=>(e=>{e.value="",e.dispatchEvent(new Event("change",{bubbles:!0}))})(t)))};l("#quick-reply #upload{background-color:#fff;border:1px solid}#quick-reply #upload>td{cursor:text}#quick-reply #upload_file{display:none}#quick-reply #upload_filename{border:none;outline:none;padding-bottom:0}",{});const d=()=>{const t=document.querySelector("form#quick-reply"),n=document.querySelector("form#quick-reply #upload_file"),o=document.querySelector("form#quick-reply #upload .spoiler");if(!n||!o)return;n.insertAdjacentHTML("afterend",'<input id="upload_filename" type="text" placeholder="Click to upload file" />');const i=document.getElementById("upload_filename");t&&i&&(i.addEventListener("click",(()=>(t=>{e.Form.hasFile(t)||t.click()})(n))),n.addEventListener("change",(t=>((t,n)=>{const o=t.target;if(!o)return;if(!e.Form.hasFile(o))return void(n.value="");n.value=o.files[0].name;const i=n.value.length;n.setSelectionRange(i,i)})(t,i))),n.addEventListener("cancel",(()=>(e=>{e.blur()})(i))),i.addEventListener("blur",(t=>((t,n)=>{const o=t.target;if(!o||!e.Form.hasFile(n))return;const i=n.files[0],r=o.value||i.name;if(i.name===r)return;const a=e.updateFile(i,{filename:r});e.Form.addFile(n,a)})(t,n))))},u=()=>{d(),o(),(()=>{const t=document.querySelector("form#quick-reply textarea[name='body']"),n=document.querySelector("form#quick-reply #upload_file");t?.addEventListener("paste",(t=>{const o=t.clipboardData;if(!o)return;const i=e.Clipboard.getImage(o);i&&n&&e.Form.addFile(n,i)}))})(),s()};try{t.onElementLoaded(u,"form#quick-reply")}catch(e){console.log("[quick-reply-addon]",e)}}();
//# sourceMappingURL=quick-reply-addon.js.map
